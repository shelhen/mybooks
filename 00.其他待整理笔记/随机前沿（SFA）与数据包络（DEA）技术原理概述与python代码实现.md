## 随机前沿与数据包络技术原理概述与python代码实现

在经济学中，技术效率的概念应用广泛。Koopmans首先提出了技术效率的概念，他将技术有效定义为：在既定的投入下产出可增加的能力或在既定的产出下投入可减少的能力。Farrell首次提出了技术效率的前沿测定方法，并得到了理论界的广泛认同，成为了效率测度的基础。在实际应用中，前沿面是需要确定的，其确定方法主要两种：一种是通过计量模型对前沿生产函数的参数进行统计估计，并在此基础上，对技术效率进行测定，这种方法被称为效率评价的“统计方法”或“参数方法”，以随机前沿分析（Stochastic Frontier Approach，SFA）为代表；另一种是通过求解数学中的线性规划来确定生产前沿面，并进行技术效率的测定，这种方法被称为“数学规划方法”或“非参数方法”，以数据包络分析（Data Envelopment Analysis，DEA）为代表。参数方法的特点是通过确定前沿生产函数的参数来确定生产前沿面，针对不同研究对象所确定的生产函数也各不相同，技术效率的测度具有一定的针对性，而非参数方法只需通过求解线性规划来确定生产前沿面，方法简单易行，应用广泛。

目前，二者已经被广泛应用于各个领域，二者各有利弊，在实际使用中应该根据具体问题和实际度量结果做出判断。

### 一、随机型前沿模型

参数方法的发展经历了两个阶段：**确定型前沿模型**和**随机型前沿模型**。Aigner等、Afriat分别提出了各自的确定型前沿模型，在不考虑随机因素影响的情况下求解前沿生产函数。但是，由于确定型前沿模型把所有可能产生影响的随机因素都作为技术无效率来进行测定，这使得其技术效率测定结果与实际的效率水平有一定的偏差。为了消除确定型前沿模型的这一缺陷，Meeusen(Meeusen and Van Den Broeck，1977)和Aigner(Aigner,Lovell and Schmidt,1977)各自独立提出了随机前沿模型(即SFA方法)，对模型中的误差项进行了区分，提高了技术效率测定的精确性。

SFA是前沿分析中参数方法的典型代表，即需要确定生产前沿的具体形式。与非参数方法相比，它的最大优点是考虑了随机因素对于产出的影响。SFA要解决的问题是要度量n个决策单元T期的技术效率（TE），每个决策单元都是m种投入和一种产出。

#### 1.基于横截面数据的随机前沿模型

SFA的基本形式为：
$$
Y_i=\beta X_i +(v_i-\mu_i),i=1,2,...,N
$$
其中，当$Y_i$表示第$i$个决策单元的产出(或者产出的对数)时，用$X_i$表示第$i$个单位的投入(或投入的对数)，当$Y_i$表示第$i$个单位的投入(或者投入的对数)时，用$X_i$表示第$i$个单位的产出(或者产出的对数)，其区别在于$Y_i$必须为单一变量，而$X_i$可以为多元的，如果需要测度单产出多投入问题，则用$Y_i$代表产出，若要测度单投入多产出问题，则用$Y_i$代表投入。

$\beta$为待估计参数，$v_i$为随机变量，一般假设其服从独立同分布的$N(0,\sigma_v^2)$，且独立于$\mu_i$，$\mu_i$为非负随机变量，用以说明生产技术的无效性，$N$为决策单元数，$I$为第$i$个决策单元投入数量的种类。

> 也有学者通过采取强制选择单一产出(投入)指标代替多产出(投入)，或者用统计方法将多个产出(投入)转化为单指标来解决多产出(投入)问题。

SFA的效率被界定为：
$$
EFF_i=\frac{E(Y_i|U_i,X_i)}{E(Y_i|U_i=0,X_i)}
$$
生产函数中，$EFF_i=e^{-\mu_i}$，其值在$0-1$之间，而成本函数中，$EFF_i=e^{\mu_i}$，该值范围在$(1,\infty)$，在实证分析中一般取$1/EFF_i$将其转换到$(0,1]$区间内。

以上讨论是基于横截面数据的随机前沿模型，Schmidt和Sickles(1984)指出了采用横截面数据所面临的两个困难：

在进行参数估计时，须设定$\mu_i$的具体分布，但这种设定缺乏经济学理论支持，具有主观性。

参数估计时，还需假定$\mu_i$与生产前沿函数中的解释变量相互独立，但对许多产业而言，独立性是不现实的。

#### 2.面板数据的随机前沿模型

参考Wang 和Ho（2010）相关研究，给定一个数据集，其中有$N$个观测值和 $T$个时期，面板随机前沿分析方法（PSFA）基本模型设定为：
$$
y_{it} = f(x_{it},\beta)e^{v_{it}-\mu_{it}},(i=1,2,...,n;t=1,2,...,T)
$$
其中$y_{it}$表示在第$t$期内第$i$个企业的产出，$f(x_{it},\beta)$代表生产函数，$x_{it}$表示在第$t$期内第$i$个企业的投入要素，$\beta$为系数，$e^{v_{it}}$是随机扰动项，表示诸如天气等随机因素对于产出的影响，由于该随机因素可使产出增加或减少，常假设$v_{it}$服从独立同分布$i.i.d N(0, \sigma v^2)$，$e^{u_{it}}$​则为投入产出效率，取对数后得到：
$$
\ln{y_{it}}=\ln{f(x_{it},\beta)}+v_{it}-\mu_{it}\\
$$
非效率项$\mu_{it}$可以进一步用以下方式模型化：
$$
\mu_{it}=\delta(t)\mu_i\\
\delta(t)=e^{\eta(T-t)}\\
$$
一般可假设$μ_i$服从半正态分布、截断正态分布、指数分布或正态分布，并假设它与$v_{it}$独立，$\delta(t)$表示了技术效率随时间变化的特点，当估计出$\eta$后，可以根据它的正负号判断出决策单元的技术效率的发展趋势：若$\eta>0$，则$\delta(t)$是$t$的单调递减函数，表示技术越来越有效率；若$\eta<0$，则$\delta(t)$是$t$的单调递增函数，表示技术越来越无效率；若$\eta=0$，则$\delta(t)=1$，表示技术效率随时间$t$没有变化。

$\varepsilon_{it} = v_{it}-u_{it}$为合成误差项，由于$\varepsilon_{it}$的期望是小于0，因此不能直接用最小二乘法估计参数，而是在求出$\varepsilon_{it}$的密度函数后用极大似然估计的方法估计出各个参数，然后通过$\mu$的条件分布去求条件期望$E(e^{-\mu_{it}}|\varepsilon_{it})$，作为技术效率$TE_{it}$的估计值。可见，$TE_{it}$是0到1之间的数，$u_{it}$越小，$TE_{it}$越大，该决策单元的技术效率越高；$1/TE_{it}$表示在当前的投入下产出可扩大的程度，当$T=1$时，模型退化为截面数据模型。通过$\Upsilon$的取值的可以判断本批数据是否有必要用SFA模型，显然$\Upsilon \in (0,1)$。
$$
TE_{it} =E(e^{-\mu_{it}}|\varepsilon_{it}) \\
\Upsilon = \frac{\sigma^2_{\mu}}{\sigma^2_{\mu}+\sigma^2_{v}}
$$
$\sigma_\mu^2$是非效率项的方差，$\sigma_v^2$是随机误差项的方差。

SFA模型中涉及两个关键的统计量：变量率 `γ` 和似然比检验 `LR`。

变量率 `γ` 是一个关键参数，用于衡量非效率项在总误差中的相对重要性。当$\Upsilon\rightarrow0$，表明$v$对$\varepsilon$和$\mu$的支配没起作用，此时可用最小二乘法分析；当$\Upsilon\rightarrow1$，表明$\mu$对$\varepsilon$和$v$的支配没起作用，此时也没有必要用SFA，可以用确定型的前沿分析。因此有必要对$\Upsilon$做是否为0的极大似然比检验，它的检验统计量渐进服从于混合$\chi^2$分布。

似然比检验 `LR` 是用来测试 `γ` 是否显著不等于0，即是否存在技术效率损失。`LR` 的计算公式为：
$$
LR=-2[\ln(L(H_0))-\ln(L(H_1))]
$$

- $L(H_0)$ 是在零假设下的似然函数值，即 `γ = 0` 的情况。
- $L(H_1)$ 是在备择假设下的似然函数值，即 `γ > 0` 的情况。

如果 `LR` 统计量大于给定显著性水平 `α` 下的卡方分布的临界值 $\chi^2_{\alpha}$，零假设 `H_0` 被拒绝，表明存在技术效率损失。此外，还需要对参数进行 `t` 检验来确定它们是否统计显著，从而筛选影响效率的因素。

#### 3.生产函数的选择

随机前沿分析方法要求设定生产函数形式，目前常用的生产函数形式为柯布道格拉斯生产函数（C-D）和超越对数生产函数（Trans-Log）。一般研究整体投入产出效率选择C-D生产函数，研究具体细分效率则选择Trans-Log生产函数。

柯布道格拉斯生产函数：$Y=A(t)L^{\alpha}K^{\beta}\mu$；超越生产函数是C-D函数$f(\ln K，\ln L)$在$(0,0)$处的近似二阶泰勒展开。

假设考虑资本（K）和劳动（L）两种投入，y 代表企业产出，则以C-D生产函数作为基准模型的随机前沿模型为：
$$
\ln y_{it}=\beta_0+\beta_1\ln K_{it} + \beta_2 \ln L_{it} + v_{it} - \mu_{it}
$$
其中$\beta_0$，$\beta_1$，$\beta_2$为代估计参数，C-D函数的优点在于形式简洁，参数有直接的经济学含义（$\beta_1$和$\beta_2$表示资本和劳动的产出弹性）。

以Trans-Log生产函数作为基准模型的随机前沿模型为：
$$
\ln y_{it}=\beta_0+\beta_1\ln K_{it} + \beta_2 \ln L_{it} +\beta_3(\ln K_{it})^2 + \beta_4(\ln L_{it})^2+\beta_5\ln K_{it}\ln L_{it} + v_{it} - \mu_{it}
$$
当$\beta_3=\beta_4=\beta_5=0$，其退化为C—D函数，Translog函数的优点在于考虑了资本和劳动相互作用对于产出的影响，克服了C—D函数替代弹性固定为1的缺点。

> 虽然C—D函数是Translog函数的特殊形式，但不意味着选择Translog函数就一定比C—D函数效果好。有的学者在应用时直接主观地选择了C—D函数或Translog函数，而正确的做法应根据客观的统计检验来决定选择使用哪种生产函数。
>
> 可以优先选择Translog函数，在参数估计后做β3=β4=β5=0是否为0的似然比检验。若不能拒绝β3=β4=β5=0的原假设，则选择C—D函数；反之则选择Translog函数。其检验统计量$LR$近似服从混合$\chi^2$分布，自由度为待检验参数的个数（这里的自由度即为3）。当然，还可再根据参数估计的结果是否符合常理及相应的t值做出综合判断。

#### 4.$\mu$的概率密度分布对于结果的影响。

有的学者困惑于$\mu$的分布选择上，因为没有理论证明μ应服从哪种分布，甚至把这点作为了SFA的主要缺点。但是根据李双杰等（2007）的研究结论，假定$\mu$服从半正态分布、截断正态分布、指数分布或正态分布时，无论哪种都对最终的结果影响不大，至少其结果的等级相关系数是很高的。当$v$服从期望为0的正态分布，$\mu$服从以上任一分布时，$\mu$的条件分布$\mu|\varepsilon$都是服从截断正态分布，而$TE$又是通过条件分布$\mu|\varepsilon$相应的条件期望求出，因此它们的$TE$值有共同的分布基础，在实际应用中，$\mu$通常选择较为简单的半正态分布或指数分布。

#### 5.$\varepsilon$​的偏度问题

根据模型的假设，易知$\varepsilon$的偏度应是负值，但是对于很多实际数据会出现正值的情况并最终导致各个决策单元的技术效率值都非常接近1。出现这样的情况主要有四种原因：一是各个决策单元生产技术本身就是非常有效率的；二是这批数据并不适合该模型，主要体现在生产函数的形式与投入产出的选择并不相适应，通常表现在参数估计的结果符号为负，且$t$值很低；三是$\mu_i$的方差$\sigma_{\mu}^2$很小，表明$v$支配$\varepsilon$，此时通常表现为$\Upsilon$值异常大；四是$\varepsilon$实际的概率分布的偏度本身为负值。当遇到上述情况时，可通过调整投入产出种类或增加样本容量来尝试解决；若仍无改进，通常只能选用其他模型（如改用DEA）。

#### 6.python实现

```python
pip install pysfa

import numpy as np
import pandas as pd
from pysfa import SFA
from pysfa.dataset import load_Tim_Coelli_frontier

# 从 Tim Coelli Frontier 4.1数据集导入数据
df = load_Tim_Coelli_frontier(x_select=['labour', 'capital'],
                              y_select=['output'])
y = np.log(df.y)
x = np.log(df.x)

# 随机前沿模型
res = SFA.SFA(y, x, fun=SFA.FUN_PROD, method=SFA.TE_teJ)
# fun参数：设置FUN_PROD (生产函数) or FUN_COST (成本函数)， 默认为生产函数
# method参数：TE_teJ：使用条件均值方法, TE_te：最小化均方误差, or TE_teMod：使用条件模式. Defaults to TE_teJ

res.optimize()

# 输出残差项
print(res.get_residuals())
print(res.summary())
 			Parameters   Std.err  t-value  Pr(>|t|)
(Intercept)     0.56162  0.207446    2.707     0.009
x1              0.53648  0.045914   11.684     0.000
x2              0.28110  0.048048    5.850     0.000
lambda          1.98270  0.835955    2.372     0.021
sigma2:  0.217
sigmav2:  0.04401 ; sigmau2:  0.17299
log likelihood:  17.02723

# 输出效率值
print(res.get_technical_efficiency())
```

### 二、数据包络分析

数据包络分析(data envelopment analysis)简称DEA，采用线性规划技术，是最常用的一种非参数前沿效率分析法。它由A.Charnes和W.W.Cooper等人于1978年创建的，以相对效率为基础对同一类型的部门的绩效进行评价。







DEA模型对误差项的考虑与SFA模型相比较为欠缺，根据本研究观测量较多的数据特征，以及SFA模型可以基于数据随机假设更好地刻画出企业的数字化管理投入产出效率水平的方法优势，

DEA可以测算多投入多产出的效率问题，但忽视了随机误差的影响，SFA优于DEA之处，是它考虑随机误差的存在对结果造成的影响，提前确定生产函数形式再研究企业的生产过程，可以提高计算技术效率的准确性，还可以分析效率与影响因素之间的相关性。（Sun et al.,2015；韩东亚和刘宏伟，2019）









#### 基于shapley的合作效益分配

例1：甲乙丙三人合作经商，每人单干时均获利1元，若甲乙合作则获利7元，甲丙合作则获利5元，乙丙合作则获利4元，当三人合作时可以获利11元，问三人合作时该如何分配获利让三方都满意？

**分别从三方考虑这个问题**

对于甲而言

|         $S_1$         | $1$  | $1U2$ | $1U2$ |  $Ⅰ$  |
| :-------------------: | :--: | :---: | :---: | :---: |
|        $V(S)$         |  1   |   7   |   5   |  11   |
|       $V(S/1)$        |  0   |   6   |   4   | **4** |
|     $V(S)-V(S/1)$     |  1   |   1   |   1   |   7   |
|         $|S|$         |  1   |   2   |   2   |   3   |
|       $W(|S|)$        | 1/3  |  1/6  |  1/6  |  1/3  |
| $W(|S|)[V(S)-V(S/1)]$ | 1/3  |   1   |  2/3  |  7/3  |

其中$W(|S|)=\frac{(n-|S|)!(|S|-1)!}{n!}$；上式*4*：表示甲不参与，乙丙合作的收益。

于是有$x_1^*=\sum{W(|S|)[V(S)-V(S/1)]}=\frac{1}{3}+1+\frac{2}{3}+\frac{7}{3}=\frac{13}{3}$

对于乙而言

|         $S_2$         | $2$  | $2U1$ | $2U3$ |  $Ⅰ$  |
| :-------------------: | :--: | :---: | :---: | :---: |
|        $V(S)$         |  1   |   7   |   4   |  11   |
|       $V(S/2)$        |  0   |   1   |   1   | **5** |
|     $V(S)-V(S/2)$     |  1   |   6   |   3   |   6   |
|         $|S|$         |  1   |   2   |   2   |   3   |
|       $W(|S|)$        | 1/3  |  1/6  |  1/6  |  1/3  |
| $W(|S|)[V(S)-V(S/2)]$ | 1/3  |   1   |  1/2  |   2   |

于是有$x_2^*=\sum{W(|S|)[V(S)-V(S/2)]}=\frac{1}{3}+1+\frac{1}{2}+2=\frac{23}{6}$

同理可求出$x_3^*=\frac{17}{6}$

例2：沿河有三个城镇甲乙丙，其中甲乙之间相距20km，乙丙之间相距38km，甲丙之间相距58km。污水需要处理后，才能排入河流，三城镇可以选择单独建立污水处理厂、合作建厂或联合建厂并使用管道将污水集中排至丙城处理，用Q表示污水产量，L表示管道长度，按照经验公式，建立污水处理厂的费用$P_i=73Q^{0.712}$千元，铺设管道的费用为$P_i=0.66Q^{0.51}L$千元，已知三城镇污水产量分别为$Q_{甲}=5$，$Q_{乙}=3$，$Q_{丙}=5$，L的数值如上距离，试从节约总投资的角度为三城镇制定污水处理方案，并确定如果联合建厂的情况下，各城镇应如何分担费用。

三城镇污水处理共有以下5种方案，

1）甲乙丙分别建厂

$C_{甲}=73\times5^{0.712}=230,C_{乙}=73\times3^{0.712}=150,C_{丙}=73\times5^{0.712}=230$

$C_{总}=C_{甲}+C_{乙}+C_{丙}=620$

2）甲乙合作，在乙城建厂

$C_{甲,乙}=73\times(5+3)^{0.712}+0.66\times5^{0.51}\times20=350$

$C_{总}=C_{甲,乙}+C_{丙}=580$

3)乙丙建厂，在丙城建厂

$C_{乙,丙}=73\times(5+3)^{0.712}+0.66\times3^{0.51}\times38=365$

$C_{总}=C_{乙,丙}+C_{甲}=595$

4）甲丙建厂，在丙城建厂

$C_{甲,丙}=73\times(5+5)^{0.712}+0.66\times5^{0.51}\times38=463$，注意这里甲和丙合作总费用已经超过了甲、丙分别建厂的总费用$C_{甲}+C_{丙}=460$，因此没有意义。

$C_{总}=C_{甲,丙}+C_{乙}=613$

5）甲乙丙建厂，在丙城建厂

$C_{甲,乙,丙}=73\times(5+3+5)^{0.712}+0.66\times5^{0.51}\times20+0.66\times(5+3)^{0.51}\times38=556$

比较结果可知，甲乙丙合作建厂并铺设管道效益更好，所以应选择联合建厂。

总费用$C_{甲,乙,丙}$中包含三部分：

| 费用               | 合计                                |
| ------------------ | ----------------------------------- |
| 联合建厂费         | $73\times(5+3+5)^{0.712}=453$       |
| 城甲至城乙的管道费 | $0.66\times5^{0.51}\times20=30$     |
| 城乙至城丙的管道费 | $0.66\times(5+3)^{0.51}\times38=73$ |

记三城为$I=(1,2,3)$，将联合建厂比单独建厂节约的投资定义为特征函数$v(x)$：

$v(\varnothing)=0$

$v(甲)=v(乙)=v(丙)=0$

$v(甲,乙)=C(甲)+C(乙)-C(甲,乙)=230+160-350=40$

$v(乙,丙)=C(乙)+C(丙)-C(乙,甲)=160+230-365=25$

$v(甲,丙)=0$

$v(甲,乙,丙)=C(甲)+C(乙)+C(丙)-C(甲,乙,丙)=230+160+230-556=64$

|         $S_1$         | $1$  | $1U2$ | $1U2$ |  $Ⅰ$   |
| :-------------------: | :--: | :---: | :---: | :----: |
|        $V(S)$         |  1   |  40   |   0   |   64   |
|       $V(S/1)$        |  0   |   0   |   0   | **25** |
|     $V(S)-V(S/1)$     |  0   |  40   |   0   |   39   |
|         $|S|$         |  1   |   2   |   2   |   3    |
|       $W(|S|)$        | 1/3  |  1/6  |  1/6  |  1/3   |
| $W(|S|)[V(S)-V(S/1)]$ |  0   | 20/3  |   0   |   13   |

...

$x_1^*=19.7,x_2^*=32.1,x_1^*=12.2$



**参考文献：**

[1] FENG S, JIA Z. Comprehensive benefit evaluation of intersections controlled by signals based on stochastic frontiers[J]. Journal of Progress in Engineering and Physical Science, 2023, 2(2): 88-95.

[2] https://www.163.com/dy/article/DHGSED6T0519BB99.html