# 04.文件管理

## 一、文件系统管理

### 1.文件查看

#### （1）绝对路径与相对路径

| 名称     | 说明                             | 案例1                  | 案例2          |
| -------- | -------------------------------- | ---------------------- | -------------- |
| 绝对路径 | 从根目录算起的路径叫做绝对路径   | `/home/python/Desktop` | `/usr/bin`     |
| 相对路径 | 从当前目录算起的路径叫做相对路径 | `../static/images`     | `./test/hello` |

#### （2）查看当前路径

显示当前工作目录的绝对路径。

```shell
pwd
# /home/shelhen
# 查看当前目录信息
```

#### （3）目录查看

`ls`是`list`的缩写，用于显示目录内容列表，`ls`选项非常多，这里了解几个简单的。

```shell
ls [选项] [文件名...]

# -R     # 递归列出遇到的子目录。
# -a     # 列出所有文件，包括以 "." 开头的隐含文件。
# -l     # 以长格式[列表方式]查看文件和目录，从左到右依次包括：权限、硬链接数、所有者名、组名、大小（byte）、时间信息（修改时间）、文件名
# -d     # 只列出目录
# -h     # 显示文件大小，默认为字节。
# -n     # 显示文件的UID和GID
# --color=auto   # 列出文件并标记颜色分类
# -s/-k     # 文件左侧输出文件大小，[s:以块(字节的某倍)为单位;k:以kb为单位]
# -S     # 按文件大小排序，降序
# -t     # 按最近修改时间排序，降序
# -u     # 按最近访问时间排序，降序
# -r.    # 逆序排序

# eg: 
ls -hl   # 列出详细信息并以可读大小显示文件大小
ls -al   # 列出所有文件（包括隐藏）的详细信息
ls -hltr /etc/  # 列出指定文件夹内文件详细信息，按修改时间逆序排序

# 扩展：以树状方式显示多层目录信息
tree
# ├── google-chrome-stable_current_amd64.deb
# ├── microsoft-edge-stable_120.0.2210.144-1_amd64.deb
# ├── pycharm-professional-2023.3.2.tar.gz
# ├── typora_1.7.6_amd64.deb
# └── Yporaject-master.zip
# 0 directories, 5 files
```

> `ls`参数中 `-l`和`-a`比较常用。

#### （4）链接与引用

`Linux`具有为一个文件起多个名字的功能，称为链接。被链接的文件可以存放在相同的目录下，但是必须有不同的文件名，而不用在硬盘上为同样的数据重复备份。链接命令是创建链接文件，链接文件分为软（符号）链接和硬链接。

| 链接   | 说明                                                         |
| ------ | ------------------------------------------------------------ |
| 软链接 | 类似于**Windows快捷方式**，当一个源文件的目录层级比较深，通过创建一个软链接方便快速访问。<br>**如果删除源文件则软链接失效。** |
| 硬链接 | 类似于**源文件的一个别名**，该**别名**和**原别名**都是指向源文件的一个引用，删除任一别名都不会删除源文件。<br>只有当所有别名都被删除时，原文件才会被删除，不同的别名之间可以保持数据同步。 |

```shell
ln [options] source target

# -s  创建软连接
# -f  如果指向文件夹内存在同名链接，则替代删除
# -i  是否替代会询问用户
# -s  创建符号链接
```

> 软连接可以跨文件系统，还可以对目录和不存在的路径进行链接，但硬链接不行。

### 2.目录切换

`cd`用于目录切换操作，当切换目录时，这个目录必须存在，`dir`可以是绝对路径或相对路径，默认为`~`（`Home`）目录。

```shell
cd [-L|-P] [dir]

# -L （默认值）如果要切换到的目标目录是一个符号连接，那么切换到符号连接的目录。
# -P 如果要切换到的目标目录是一个符号连接，那么切换到它指向的物理位置目录。

# egs
cd /  # 进入根目录
cd ~  # 进入用户主目录；
cd ..  # 返回上级目录（若当前目录为“/“，则执行完后还在“/"；".."为上级目录的意思）；
cd -  # 切换到上一次目录
# 切换到指定目录
cd /home/python/Desktop
```

当敲出 文件或者目录或者命令 的前几个字母之后，按下 tab 键，如果输入的没有歧义，系统会自动补全。**当切换目录或者使用命令的时候，如果不确定当前目录下有那些子目录或者其它命令，可以通过两次tab键查看。**

拓展：环境变量`CDPATH`是由冒号分割的一到多个目录，可以将常去的目录的上一级加入到`CDPATH`以便方便访问它们。

```shell
mkdir ~/Desktop/test
CDPATH='~/Desktop'
cd test3
```

> 如果CDPATH存在值，优先在CDPATH中查找并进入第一个匹配成功的，如果全部失败才尝试当前目录。

### 3.文件操作

#### （1）创建-删除目录

```shell
# 创建/删除空目录 - mkdir / rmdir
mkdir abc
mkdir a b c # 同时创建a/b/c三个目录
# -p 创建所依赖的文件夹
mkdir -p xyz/abc # 递归创建目录
# -m 赋予权限
mkdir -m 755 abb

# 删除文件夹
rmdir abc
rmdir a b c
rmdir -p xyz/abc # 递归删除空目录
```

#### （2）创建-删除文件

- 创建文件`touch`

`touch`命令用于创建空白文件或修改文件时间

```shell
touch readme.txt 
touch readme1.txt readme2.txt # 同时创建多个文件

# -a. 等价于 --time=access，更改存取时间为当前时间
# -c. 等价于 --time=create，更改创建时间为当前时间
# -m. 等价于 --time=modify，更改变动时间为当前时间
# -r <path> 将所选文件的各项时间更改为与指定path相同
# -t. <日期>  将所选文件时间更改为指定时间
```

- 删除文件

```shell
rm [options] [paramers]

# -f：强制删除文件或目录；
# -r或-R：递归处理，将指定目录下的所有文件与子目录一并处理；
# -d 删除空目录
# -i 交互式删除，每个删除项都会进行询问。  

# eg:
rm error.txt
rm -rf xyz
rm -rf *.html  # 删除当前项目下 .html 结尾的文件
```

> rm既可以删除文件也可以删除目录，还可递归删除。

#### （3）文件目录复制

`cp`将一个或多个源文件或者目录复制到指定的目的文件或目录，如果把一个文件复制到一个目标文件中，而目标文件已经存在，那么，该目标文件的内容将被破坏。

```shell
cp [options] [paramers]

# -d  当复制符号连接时，把目标文件或目录也建立为符号连接，并指向与源文件或目录连接的原始文件或目录
# -l  对源文件建立硬连接，而非复制文件； 
# -s  对源文件建立符号连接，而非复制文件；
# -i  目标路径有同名文件时，是否覆盖先询问用户；
# -b  覆盖目标文件前，在目标文件夹创建副本，*.babelrc
# -r/R 递归复制，将指定目录下的所有文件与子目录一并处理；
# -p  复制时保留原文件权限
# eg:
cp readme.txt ../shelhen/dont_readme.md
cp -rfb ../backup .
```

#### （4）文件移动与重命名

`mv`对文件或目录重新命名，或者将文件从一个目录移到另一个目录中。如果将一个文件移到一个已经存在的目标文件中，则目标文件的内容将被覆盖。`mv`支持两种移动，若`target`是一个目录，则将`source`指向的所有文件都移动到`target`指向的目录中，若目录中存在同名文件，则覆盖；若`target`是一个文件路径，则表示将`source`移动至`target`，若`target`已存在，则会被覆盖。

```shell
mv [options] source target 

# -b  若目标路径存在文件，则在覆盖前备份。
# -f  若目标路径存在文件，强行覆盖。
# -i  若目标路径存在文件，则交互式询问是否覆盖。
# -v  移动完成后，输出移动信息。

# eg:
mv a b  # 若b是一个目录名，则将a移动至b目录中，否则，等价于将a重命名为b。
mv a.txt b/b.txt # 移动并且重命名
# 移动多个文件
mv *.txt /home/office/
mv file_2.txt file_3.txt file_4.txt /home/office/
# 移动目录
mv directory_1/ /home/office/


# rename也可以用于重命名
rename .htm .html *.htm
```

> `mv`不管是针对文件还是文件夹都不需要加`-r`选项。

## 二、文件打包与压缩

最早的`Linux`备份介质是磁带，在文件备份时一般先进行打包，打包是指将一大堆文件或目录变成一个总的档案，可以在档案中修改文件，或加入新的文件，打包文件的后缀名一般为`.tar`，打包可以方便文件管理和网络传输，又称归档。

文件归档后还可以进一步对文件进行压缩，将一个大的文件通过一些压缩算法变成一个小文件。`linux`早期支持的压缩文件的扩展名为`.gz`和`.bz2.tgz`，如今几乎所有压缩形式都支持了，但默认支持`.gz`、`.tgz`和`.zip`的形式，其中`.gz`和`.bz2`的压缩包可以使用`tar`命令来压缩和解压缩，其优点是占用空间较少，`.zip`的压缩包需要使用`zip`命令来压缩，使用`unzip`命令来解压缩，有点在于压缩速度快，`cpu`开销比较低，通用型更好。

### 1.归档与解档

```shell
tar [options] *targets


# -c 创建打包文件
# -x 从归档中解出文件
# -v 显示过程详细信息
# -f 指定打包后的文件名称
# -t 列出制定包内的所有文件
# -r 追加文件至归档结尾
# -C <dirname>  解归档到指定文件夹
# --remove-files  归档后删除原文件

# eg:
# 将当前目录下的redis-4.0.10目录打包，打包为redis-4.0.10.tar。
tar -cvf redis-4.0.10.tar redis-4.0.10
# 从文件a.txt\b.txt\c.txt打包为abc.tar
tar -cvf abc.tar a.txt b.txt c.txt
# 将所有以.py结尾的文件和目录config打包
tar -cvf example.tar *.py config
# 将logo.gif添加至example.tar
tar -uf example.tar logo.gif
# 列出example.tar中所有文件
tar -tf example.tar
# 将当前目录下的redis-4.0.10.tar解包
tar -xvf redis-4.0.10.tar -C .
```

### 2.` tar`格式压缩与解压缩

| 格式   | 说明                                                |
| ------ | --------------------------------------------------- |
| `gzip` | 压缩速度快，压缩率低，cpu开销比较低                 |
| `bzip` | 压缩速度慢，压缩率高，cpu开销大                     |
| `xz`   | 压缩率高，解压速度快，压缩时间较长，cpu消耗相对较大 |

- 若前面已经对文件进行过归档

```shell
# 压缩.gz
gzip example.tar
# 压缩.bz2
bzip2 example.tar
# 压缩.xz
xz example.tar

# 解压缩.gz
gunzip example.tar.gz -C target_dir
# 解压缩.bz2
bunzip2 example.tar.bz2 -C target_dir
# 解压缩.xz
unxz example.tar.xz 
```

- 一次性打包同时压缩

```shell
# 压缩.gz
tar -zcvf abc.tar.gz a.txt b.txt c.txt
# 压缩.bz2
tar -jcvf abc.tar.bz2 a.txt b.txt c.txt
# 压缩.xz
tar -Jcvf abc.tar.xz [abc].txt

# 解压缩.gz
tar - zxvf abc.tar.gz -C .
# 解压缩.bz2
tar -jxvf abc.tar.bz2 -C target_dir
# 解压缩.xz
tar -Jxvf abc.tar.xz -C target_dir
```

### 3.`zip`格式压缩与解压

```shell
# 压缩
zip -r abc.zip *.txt
# 解压缩到指定目录
unzip abc.zip -d ~/Desktop
```

### 4.`jar`格式压缩与解压

```shell
jar -cvf abc.jar *.txt
jar -xvf abc.jar
```

> 如果打包的是`java`类库，并且该类库中存在主类，则需要一个`META-INF/MANIFEST.MF`配置文件。 

### 5.`7z`格式压缩与解压

```shell
# 压缩
7z a example.7z *.py
7z a example.rar *.md
# 解压缩
7z x example.7z
7z x example.rar
```

> `7z`命令支持`.rar`压缩包。

## 三、文件权限管理

`linux`是一个多用户多任务的系统，为了让各个用户能够具有保密数据的文件。文档的权限管理就很重要。权限是指某个特定用户具有特定的系统资源使用权利，文档需要设置的权限信息，文档可以是文件，也可以是文件夹，可以是相对路径也可以是绝对路径。

### 1.用户身份与权限类型

`linux`中一般将文档存取访问的身份分为四种用户身份和三种权限类型。

#### （1）用户身份

| 表示 | 代码    | 说明       |
| ---- | ------- | ---------- |
| `u`  | `owner` | 文档拥有者 |
| `g`  | `group` | 所属组     |
| `o`  | `other` | 其他用户   |
| `a`  | `root`  | 全部身份   |

#### （2）权限类型

| 权限                  | 文件夹                      | 文件         | 符号 |
| --------------------- | --------------------------- | ------------ | ---- |
| 读权限（`read`）      | 查询目录结构                | 查看文件内容 | `r`  |
| 写权限（`write`）     | 文件创建/删除/复制/移动操作 | 文档编辑     | `w`  |
| 执行权限（`execute`） | 文件夹内执行命令            | 支持运行     | `x`  |

> 想要删除一个文件，并不是看是否拥有该文件的写权限，而是看是否拥有该文档所在文件夹的写权限。

### 2.权限查看

#### （1）文件类型

`linux`中一切皆文件，一切命令、可执行代码及目录都是文件，文件的类型具体如下表所示：

| 类型 | 说明                 | 类型 | 说明                       |
| ---- | -------------------- | ---- | -------------------------- |
| `-`  | 普通文件             | `l`  | 软连接文件                 |
| `d`  | 目录文件             | `f`  | 命名管道文件               |
| `b`  | 块文件，如存储设备。 | `c`  | 字符设备，如鼠键、音响等。 |
| `s`  | 套接字文件           |      |                            |

#### （2）权限查看

```shell
# 借助曾经学习的`ls -l 查看权限
ls -l readme.txt
# -rw-r--r--. 1 root root 15 3月  11 11:41 readme.txt

# 查看目录权限
ll -d dirname
```

权限的查询结果理解：

| 档案类型及权限 | 连接数 | 拥有者 | 所属组 | 容量   | 档案最后修改时间 | 档案名称     |
| -------------- | ------ | ------ | ------ | ------ | ---------------- | ------------ |
| `-rw-r--r--`   | `1`    | `root` | `root` | `1.4K` | `3月  11 11:41`  | `readme.txt` |

与文档权限相关的为第一个内容`-rw-r--r--`，第一位代表文件类型，`2~4`位代表所有者权限、`5-7`代表所属组权限、`8-10`代表其他人权限。其中，`-`代表没有权限，`r`、`w`和`x`分别代表读、写和执行权限。上述字段代表，该文件是普通文件，文件所有者具有读写权限，所属组及其他用户仅有读取权限。

#### （3）权限的数字形式

在`linux`中另一种设置权限的形式是数字形式，在数字权限形式中，分别用`0~2`和数字`4`表示读、写及执行权限，具体对应关系：

| 数字 | 权限 | 说明   | 数字 | 权限 | 说明     |
| ---- | ---- | ------ | ---- | ---- | -------- |
| `0`  | `-`  | 无权限 | `4`  | `r`  | 读权限   |
| `2`  | `w`  | 写权限 | `1`  | `x`  | 执行权限 |

例如，上文中的`rw_r__r__`，前三位分别对应$4+2+0=6$，中间和最后三位分别对应$4+0+0=4$，即文件权限为`644`。另外由权限关系可知，可写必定可读，可执行则必定可写，因此任一位权限表示必定处于`[0,4,6,7]`中，且与权限关系一一对应。又由于文档拥有者权限必定大于等于组权限，组权限又必定大于等于其他人权限，故权限数值又有自左向右递减的规律。

### 3.权限修改

权限的修改方式主要包括三种，即增加权限（`+`）、降低权限（`-`）和权限赋值（`=`），权限修改主要考虑三个问题：谁的权限？如何修改？修改为什么？

用户可以使用`chmod`直接变更自身的文件或目录的权限。

```shell
chmod [options]... mode [,mode]... file
chmod [options]... 

# -R 对文件夹内部递归修改权限
# --reference=filename  # 参考指定路径的文件或目录修改权限
```

#### （1）更改文件或目录权限

```shell
# eg
ls -l readme.txt
# -rw-r--r--. 1 root root 15 3月  11 11:41 readme.txt

# 添加用户组写权限
chmod g+w ./readme.txt
# 删除其他用户所有权限
chmod o= ./readme.txt
# 删除所有用户的写权限
chmod a-w ./readme.txt

# 直接为各类用户设置权限
chmod u=rw,go=r readme.txt
chmod u=rwx, g=rw, o=r ./readme.txt
chmod 764 ./readme.txt  # 与上一步等价

# 将目录以及目录下的文件都设置为所有用户拥有读写权限。
chmod -R a=rw ./*
# 根据其他文件的权限设置文件权限。
chmod --reference=./1.log  ./readme.txt
```

> 使用`'-R'`选项一定要保留当前用户的执行和读取权限，否则会报错！

#### （2）所有者及所属组管理

`chown`改变某个文件或目录的所有者和所属的组，该命令可以向某个用户授权，使该用户变成指定文件的所有者或者改变文件所属的组。

**普通用户不能修改文件的所有者，只有文件主和超级用户才可以使用该命令。**

```shell
chown [options] 所有者[:所属组] 文件或目录

# -R 递归修改权限

# 修改readme.txt的所有者和所有组为zhangsan
chown shelhen:zhangsan readme.txt
# 修改nginx目录的所有者和所属组为lisi
chown -R lisi nginx

# `chgrp`用于单独更更改属组，并不常用。
# chgrp [选项] 用户组 文件或目录

# 修改nginx的用户组为wanger
chgrp -R wanger nginx
```

### 4.umask默认权限(了解)

Linux `umask`（用户文件创建[掩码](https://so.csdn.net/so/search?q=掩码&spm=1001.2101.3001.7020)）是一个控制新建文件和目录权限的系统设置。当一个进程创建一个新文件或目录时，`umask`值将影响其默认权限。`umask`的值是一个 3 位或 4 位的八进制数，分别表示了`用户（user）`、`组（group）`和`其他用户（other）`的权限。

#### （1）文件/目录的默认权限值

由于执行权限`(x)`对文件来讲比较危险，不能在新建文件的时候默认赋予，而必须通过用户手工赋予。因此文件的默认权限通常为 `666`（即 `rw-rw-rw-`），但是对目录而言，执行权限(x)仅仅代表进入目录，所以即使建立新目录时直接默认赋予，也没有什么危险。因此目录的默认权限通常为 `777`（即 `rwxrwxrwx`）。

#### （2）文件实际权限计算

文件的实际权限（`umask`补码）等于将`默认权限值`与`umask 补码`进行按`位与`操作（`bitwise AND`），实际计算公式给如下：

```shell
文件：666 - umask（奇数位减1要恢复偶数）；
目录：777 - umask
# 假设umask码为021
6 - (0 - 0) = 6
6 - (2 - 0) = 4
6 - (1 - 1) = 6
新建文件的默认权限为 646（rw-r–rw-），新建目录的默认权限为 756（rwxr-xrw-）
```









